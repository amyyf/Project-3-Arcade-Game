// from:https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/remove()/remove().md
(function (arr) {
  arr.forEach(function (item) {
    if (item.hasOwnProperty('remove')) {
      return;
    }
    Object.defineProperty(item, 'remove', {
      configurable: true,
      enumerable: true,
      writable: true,
      value: function remove() {
        if (this.parentNode !== null)
          this.parentNode.removeChild(this);
      }
    });
  });
})([Element.prototype, CharacterData.prototype, DocumentType.prototype]);
'use strict';var startButton=document.getElementById('start');startButton.addEventListener('click',startGame);function startGame(){removeParagraphs();var a=new Game;a.makeBug(),window.game=a,window.allEnemies=a.enemies,window.player=a.player,Engine(window),document.addEventListener('keyup',function(b){b.preventDefault();a.player.handleInput({37:'left',38:'up',39:'right',40:'down'}[b.keyCode])})}function removeParagraphs(){var a=document.getElementById('head');a.nextElementSibling.remove(),a.nextElementSibling.remove()}var Game=function(){this.columns=[0,100,200,300,400],this.rows=[-20,60,140,220,300,380],this.enemyRows=this.rows.slice(1,4),this.playerStartX=2,this.playerStartY=5,this.winningRow=0,this.player=new Player(this),this.enemies=new Set,this.scoreboard=new Scoreboard(this)};Game.prototype.makeBug=function(){var a=new Enemy(this);this.enemies.add(a),this.timeout=setTimeout(this.makeBug.bind(this),getIntervalTime())};function getIntervalTime(){var a=1e3*Math.random()+500;return a}Game.prototype.gameOver=function(){clearTimeout(this.timeout),this.player=null,this.enemies=null;var a=document.createElement('div'),b='\n    <p class="game-over">Game over!</p>\n    <p class="game-over">Your score was '+this.scoreboard.score+'</p>\n    <p class="game-over">Please refresh the page to play again</p>\n  ',c=document.getElementById('box');c.remove(),a.innerHTML=b,document.body.append(a),document.getElementsByTagName('canvas')[0].remove(),startButton.remove(),this.checkHighScore()},Game.prototype.checkHighScore=function(){try{var a=window.localStorage.getItem('high score'),b=this.scoreboard.score,c=document.createElement('div');if(b>a){window.localStorage.setItem('high score',''+this.scoreboard.score);c.innerHTML='\n        <p class="game-over">Congratulations! You have the new high score!</p>\n      '}else{c.innerHTML='\n        <p class="game-over">The high score is '+a+' - try again!</p>\n      '}document.body.append(c)}catch(g){}};var Scoreboard=function(a){this.game=a,this.score=0,this.timer=60;var b=window.document,c=b.createDocumentFragment(),d=b.createElement('div'),f=b.createElement('div'),g=b.createElement('div'),h=b.createElement('span'),i=b.createElement('span');d.setAttribute('id','box'),h.setAttribute('id','timerDisplay'),i.setAttribute('id','scoreDisplay'),f.textContent='Seconds remaining: ',g.textContent='Score: ',h.textContent=this.timer,i.textContent=this.score,g.appendChild(i),f.appendChild(h),d.appendChild(f),d.appendChild(g),c.appendChild(d),document.body.appendChild(c),this.scoreDisplay=i,this.timerDisplay=h,this.countdown(this.game)};Scoreboard.prototype.countdown=function(a){var c=this;this.game=a;var b=setInterval(function(){0===c.timer?(clearInterval(b),c.game.gameOver()):(c.timer--,c.timerDisplay.textContent=c.timer)},1e3)},Scoreboard.prototype.increaseScore=function(){this.score++,this.scoreDisplay.textContent=this.score},Scoreboard.prototype.decreaseScore=function(){0<this.score&&(this.score--,this.scoreDisplay.textContent=this.score)};var Enemy=function(a){this.sprite='images/enemy-bug.png',this.x=-100,this.y=pickRow(a),this.speed=400*Math.random()+200};function pickRow(a){var b=a.enemyRows,c=Math.floor(Math.random()*b.length);return b[c]}Enemy.prototype.update=function(a){this.x+=this.speed*a,this.x>ctx.canvas.width&&window.allEnemies.delete(this)},Enemy.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)};var Player=function(a){this.game=a,this.sprite='images/char-boy.png',this.positionX=a.playerStartX,this.positionY=a.playerStartY,this.x=a.columns[this.positionX],this.y=a.rows[this.positionY]};Player.prototype.handleInput=function(a){'left'===a?0<this.positionX&&this.positionX--:'up'===a?0<this.positionY&&this.positionY--:'right'===a?this.positionX<this.game.columns.length-1&&this.positionX++:'down'===a?this.positionY<this.game.rows.length-1&&this.positionY++:void 0;this.calculateScore()},Player.prototype.update=function(){var b=this;this.x=this.game.columns[this.positionX],this.y=this.game.rows[this.positionY];var a=this.game.enemies;Array.from(a).forEach(function(c){c.y===b.y&&c.x+40>b.x&&c.x-40<b.x&&(b.game.scoreboard.decreaseScore(),b.positionX=b.game.playerStartX,b.positionY=b.game.playerStartY)})},Player.prototype.render=function(){ctx.drawImage(Resources.get(this.sprite),this.x,this.y)},Player.prototype.calculateScore=function(){var a=this;window.setTimeout(function(){a.positionY===a.game.winningRow&&(a.positionX=a.game.playerStartX,a.positionY=a.game.playerStartY,a.game.scoreboard.increaseScore())},250)};
